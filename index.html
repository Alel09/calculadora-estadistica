<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Estadística</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .config-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .config-section input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .config-section input:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .clase-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .clase-item h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-small {
            padding: 8px 20px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .results {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .results h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .result-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #c33;
        }

        .success {
            background: #efe;
            color: #3c3;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3c3;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Calculadora Estadística</h1>
            <p>Cuartiles, Deciles y Percentiles para Datos Agrupados</p>
        </div>

        <div class="content">
            <div class="config-section">
                <label for="decimales">Número de decimales (0-10):</label>
                <input type="number" id="decimales" min="0" max="10" value="2">
            </div>

            <div class="config-section">
                <label for="numClases">¿Cuántas clases de datos tienes?</label>
                <input type="number" id="numClases" min="1" value="5">
                <button class="btn" onclick="generarInputs()" style="margin-top: 15px;">Generar Campos</button>
            </div>

            <div id="inputClases" class="input-section"></div>

            <div class="button-group">
                <button class="btn" onclick="calcularCuartiles()">Calcular Cuartiles</button>
                <button class="btn" onclick="calcularDeciles()">Calcular Deciles</button>
                <button class="btn" onclick="calcularAmbos()">Cuartiles y Deciles</button>
                <button class="btn btn-secondary" onclick="calcularPercentilPersonalizado()">Percentil Personalizado</button>
                <button class="btn btn-secondary" onclick="mostrarTabla()">Mostrar Tabla de Frecuencias</button>
            </div>

            <div id="resultados"></div>
        </div>
    </div>

    <script>
        let datos = [];

        function generarInputs() {
            const numClases = parseInt(document.getElementById('numClases').value);
            const container = document.getElementById('inputClases');
            container.innerHTML = '';

            if (numClases < 1) {
                mostrarError('Por favor ingresa un número válido de clases.');
                return;
            }

            for (let i = 0; i < numClases; i++) {
                const claseDiv = document.createElement('div');
                claseDiv.className = 'clase-item';
                claseDiv.innerHTML = `
                    <h3>Clase ${i + 1}</h3>
                    <div class="input-group">
                        <div>
                            <label>Rango (ej: 12-14):</label>
                            <input type="text" id="rango${i}" placeholder="12-14">
                        </div>
                        <div>
                            <label>Frecuencia:</label>
                            <input type="number" id="freq${i}" min="0" value="0">
                        </div>
                    </div>
                `;
                container.appendChild(claseDiv);
            }
        }

        function parsearRango(rango) {
            const patron = /^(\d+(?:\.\d+)?)-(\d+(?:\.\d+)?)$/;
            const match = rango.trim().match(patron);

            if (!match) {
                throw new Error(`Formato de rango inválido: ${rango}`);
            }

            const inicio = parseFloat(match[1]);
            const fin = parseFloat(match[2]);

            if (inicio >= fin) {
                throw new Error(`El valor inicial debe ser menor que el final: ${rango}`);
            }

            return { inicio, fin };
        }

        function recopilarDatos() {
            const numClases = parseInt(document.getElementById('numClases').value);
            datos = [];

            for (let i = 0; i < numClases; i++) {
                const rango = document.getElementById(`rango${i}`).value;
                const freq = parseInt(document.getElementById(`freq${i}`).value);

                if (!rango || isNaN(freq) || freq < 0) {
                    throw new Error(`Datos inválidos en la clase ${i + 1}`);
                }

                parsearRango(rango); // Validar formato
                datos.push({ rango, frecuencia: freq });
            }

            if (datos.length === 0) {
                throw new Error('No hay datos para procesar');
            }

            return datos;
        }

        function calcularMarcaClase(rango) {
            const { inicio, fin } = parsearRango(rango);
            return (inicio + fin) / 2;
        }

        function calcularPercentiles(datos, percentiles) {
            const decimales = parseInt(document.getElementById('decimales').value);
            const n = datos.reduce((sum, d) => sum + d.frecuencia, 0);
            
            if (n === 0) throw new Error('La suma de frecuencias no puede ser cero');

            const resultados = [];

            for (const p of percentiles) {
                if (p <= 0 || p > 1) {
                    throw new Error(`El percentil debe estar entre 0 y 1: ${p}`);
                }

                const pos = p * n;
                let acumulado = 0;
                let encontrado = false;

                for (const dato of datos) {
                    const acumuladoAnterior = acumulado;
                    acumulado += dato.frecuencia;

                    if (acumulado >= pos) {
                        const { inicio, fin } = parsearRango(dato.rango);
                        let valor;

                        if (acumuladoAnterior >= pos) {
                            valor = inicio;
                        } else {
                            const amplitud = fin - inicio;
                            const factor = (pos - acumuladoAnterior) / dato.frecuencia;
                            valor = inicio + (factor * amplitud);
                        }

                        resultados.push(parseFloat(valor.toFixed(decimales)));
                        encontrado = true;
                        break;
                    }
                }

                if (!encontrado) {
                    const { fin } = parsearRango(datos[datos.length - 1].rango);
                    resultados.push(parseFloat(fin.toFixed(decimales)));
                }
            }

            return resultados;
        }

        function calcularCuartiles() {
            try {
                const datos = recopilarDatos();
                const cuartiles = calcularPercentiles(datos, [0.25, 0.5, 0.75, 1.0]);
                
                let html = '<div class="results"><h2>📈 CUARTILES</h2><div class="results-grid">';
                cuartiles.forEach((valor, i) => {
                    html += `<div class="result-item"><strong>Q${i + 1}:</strong> ${valor}</div>`;
                });
                html += '</div></div>';
                
                document.getElementById('resultados').innerHTML = html;
            } catch (error) {
                mostrarError(error.message);
            }
        }

        function calcularDeciles() {
            try {
                const datos = recopilarDatos();
                const deciles = calcularPercentiles(datos, Array.from({length: 10}, (_, i) => (i + 1) / 10));
                
                let html = '<div class="results"><h2>📈 DECILES</h2><div class="results-grid">';
                deciles.forEach((valor, i) => {
                    html += `<div class="result-item"><strong>D${i + 1}:</strong> ${valor}</div>`;
                });
                html += '</div></div>';
                
                document.getElementById('resultados').innerHTML = html;
            } catch (error) {
                mostrarError(error.message);
            }
        }

        function calcularAmbos() {
            try {
                const datos = recopilarDatos();
                const cuartiles = calcularPercentiles(datos, [0.25, 0.5, 0.75, 1.0]);
                const deciles = calcularPercentiles(datos, Array.from({length: 10}, (_, i) => (i + 1) / 10));
                
                let html = '<div class="results">';
                html += '<h2>📈 CUARTILES</h2><div class="results-grid">';
                cuartiles.forEach((valor, i) => {
                    html += `<div class="result-item"><strong>Q${i + 1}:</strong> ${valor}</div>`;
                });
                html += '</div>';
                
                html += '<h2 style="margin-top: 30px;">📈 DECILES</h2><div class="results-grid">';
                deciles.forEach((valor, i) => {
                    html += `<div class="result-item"><strong>D${i + 1}:</strong> ${valor}</div>`;
                });
                html += '</div></div>';
                
                document.getElementById('resultados').innerHTML = html;
            } catch (error) {
                mostrarError(error.message);
            }
        }

        function calcularPercentilPersonalizado() {
            const p = prompt('Ingresa el percentil (0-100):');
            if (p === null) return;

            const percentil = parseFloat(p);
            if (isNaN(percentil) || percentil <= 0 || percentil > 100) {
                mostrarError('El percentil debe estar entre 0 y 100');
                return;
            }

            try {
                const datos = recopilarDatos();
                const resultado = calcularPercentiles(datos, [percentil / 100]);
                
                const html = `<div class="results"><h2>📈 PERCENTIL ${percentil}</h2>
                    <div class="stat-card"><h4>Valor</h4><div class="value">${resultado[0]}</div></div></div>`;
                
                document.getElementById('resultados').innerHTML = html;
            } catch (error) {
                mostrarError(error.message);
            }
        }

        function mostrarTabla() {
            try {
                const datos = recopilarDatos();
                const decimales = parseInt(document.getElementById('decimales').value);
                
                let html = '<div class="results"><h2>📊 TABLA DE FRECUENCIAS</h2>';
                html += '<table><thead><tr><th>Clase</th><th>Frecuencia</th><th>Frec. Acum.</th><th>Marca Clase</th><th>f × m</th></tr></thead><tbody>';
                
                let acumulado = 0;
                let sumaFM = 0;
                
                datos.forEach(dato => {
                    acumulado += dato.frecuencia;
                    const marca = calcularMarcaClase(dato.rango);
                    const fm = dato.frecuencia * marca;
                    sumaFM += fm;
                    
                    html += `<tr>
                        <td>${dato.rango}</td>
                        <td>${dato.frecuencia}</td>
                        <td>${acumulado}</td>
                        <td>${marca.toFixed(decimales)}</td>
                        <td>${fm.toFixed(decimales)}</td>
                    </tr>`;
                });
                
                html += `<tr style="font-weight: bold; background: #f0f0f0;">
                    <td>Total</td>
                    <td>${acumulado}</td>
                    <td></td>
                    <td></td>
                    <td>${sumaFM.toFixed(decimales)}</td>
                </tr></tbody></table>`;
                
                const media = sumaFM / acumulado;
                const mediana = calcularPercentiles(datos, [0.5])[0];
                
                html += '<div class="stats-summary">';
                html += `<div class="stat-card"><h4>Media</h4><div class="value">${media.toFixed(decimales)}</div></div>`;
                html += `<div class="stat-card"><h4>Mediana</h4><div class="value">${mediana}</div></div>`;
                html += '</div></div>';
                
                document.getElementById('resultados').innerHTML = html;
            } catch (error) {
                mostrarError(error.message);
            }
        }

        function mostrarError(mensaje) {
            document.getElementById('resultados').innerHTML = 
                `<div class="error">❌ Error: ${mensaje}</div>`;
        }

        // Generar inputs iniciales al cargar
        window.onload = () => generarInputs();
    </script>
</body>
</html>